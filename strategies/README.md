# 策略库说明文档

## 目录结构

```
strategies/
├── README.md                                  # 本文档
├── index_futures_settlement_arbitrage.py      # 股指期货结算价差套利策略
└── ... (后续添加更多策略)
```

---

## 策略1：股指期货结算价差套利策略

### 📊 策略概述

| 属性 | 描述 |
|------|------|
| **策略名称** | 股指期货结算价差套利策略 |
| **适用品种** | IC(中证500股指期货)、IM(中证1000股指期货) |
| **策略类型** | 日内套利/价差交易 |
| **时间框架** | 日内（分钟级数据） |
| **风险等级** | 中等 |

### 🎯 策略原理

#### 核心逻辑
该策略利用**期货收盘价与结算价之间的差异**进行套利：

1. **股指期货结算机制**
   - 期货收盘价 ≠ 结算价
   - 股指期货按**最后一小时成交量加权平均价(VWAP)**结算
   - 黄金期货更夸张：按**全天成交均价**结算

2. **套利机会**
   - 尾盘过度下跌时买入
   - 可以赚取收盘价与结算价之间的价差
   - 如果市场在尾盘非理性下跌，结算价往往高于收盘价

#### 图解说明

```
价格
  │
  │      ╭─ 14:30 参考价
  │     /
  │    /
  │───•─────────────────────── 结算价 (VWAP)
  │         \
  │          \  下跌超过1%
  │           \
  │            ╰─ 收盘价 (买入点)
  │
  └──────────────────────────────→ 时间
        14:30    15:00
```

### 📋 交易规则

#### 入场条件 (二选一)
1. **主条件**：下午2:30后，远月合约相对于2:30时的价格继续下跌超过1%
2. **追加条件**：在主条件触发后，若价格再下跌1%（累计2%），可继续买入

#### 出场条件
- **第二天开盘卖出**

#### 策略参数

| 参数 | 默认值 | 说明 |
|------|--------|------|
| `ENTRY_TIME` | 14:30 | 开始监控的时间点 |
| `DROP_THRESHOLD` | 1% | 触发买入的下跌幅度 |
| `ADDITIONAL_DROP` | 1% | 追加买入的额外下跌幅度 |

### 📈 理论收益分析

以图片中提到的实际案例为例：

| 品种 | 情况 | 潜在收益 |
|------|------|----------|
| 股指期货 | 结算价比收盘价高100多点 | 约2万/手 |
| 黄金期货 | 跌停板买入，价差约8% | 约8万/手（按一手100多万计算） |

### ⚠️ 风险提示

1. **流动性风险**：远月合约流动性可能较差
2. **持仓过夜风险**：需要承担隔夜持仓的不确定性
3. **结算价不确定性**：结算价虽然通常高于极端下跌的收盘价，但不保证
4. **保证金风险**：期货交易需要注意保证金管理
5. **极端行情风险**：如果市场持续下跌，可能面临损失

### 💡 优化建议

1. **结合成交量分析**
   - 如果尾盘下跌伴随缩量，套利成功概率更高
   - 放量下跌可能预示趋势性行情

2. **多品种对冲**
   - 可同时监控IC和IM
   - 选择偏离更大的品种

3. **动态止损**
   - 设置最大亏损限制
   - 如果次日开盘跳空低开，考虑止损

### 🔧 在QuantDinger中的实现

#### 数据要求
- **数据频率**：分钟级K线数据
- **必需字段**：time, open, high, low, close, volume
- **品种代码**：IC(中证500)、IM(中证1000)远月合约

#### 代码结构
```python
# 1. 参数定义
ENTRY_TIME = time(14, 30)
DROP_THRESHOLD = 0.01

# 2. 计算从14:30开始的跌幅
price_change = calculate_price_change_from_time(df, ENTRY_TIME)

# 3. 生成买卖信号
buy = (is_after_time(df, ENTRY_TIME)) & (price_change < -DROP_THRESHOLD)
sell = buy.shift(1)  # 次日开盘卖出

# 4. 输出到QuantDinger
output = {
    'name': '股指期货结算价差套利策略',
    'plots': [...],
    'signals': [...]
}
```

#### 回测注意事项

1. **数据源**：需要接入支持A股期货的数据源
2. **时间过滤**：策略仅在14:30-15:00时段有效
3. **合约选择**：选择远月合约（流动性适中）
4. **滑点设置**：期货交易建议设置1-2跳滑点

---

## 需求分析总结

### 当前实现状态

| 功能模块 | 状态 | 说明 |
|----------|------|------|
| 策略文件夹结构 | ✅ 已完成 | 创建于 `/strategies` 目录 |
| 策略逻辑代码 | ✅ 已完成 | 兼容QuantDinger格式 |
| 策略文档 | ✅ 已完成 | 包含详细分析 |
| 数据源集成 | ⏳ 待开发 | 需要A股期货数据接口 |
| 回测验证 | ⏳ 待测试 | 需要历史数据进行验证 |

### 后续开发建议

1. **数据源扩展**
   - 添加对中国期货市场的数据支持
   - 集成CTP或其他期货行情接口

2. **策略增强**
   - 添加更多入场条件筛选
   - 实现动态止损止盈

3. **监控告警**
   - 在2:30后实时监控价格变化
   - 达到条件时发送通知

### 文件引用

- 策略代码：[index_futures_settlement_arbitrage.py](./index_futures_settlement_arbitrage.py)
- QuantDinger策略开发指南：[STRATEGY_DEV_GUIDE_CN.md](../docs/STRATEGY_DEV_GUIDE_CN.md)
